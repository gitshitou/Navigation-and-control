来源：       https://www.cs.unc.edu/~welch/kalman/media/pdf/Julier1997_SPIE_KF.pdf

# 一个新的扩展卡尔曼滤波方法应用到非线性系统

## 摘要

　　卡尔曼滤波器（KF）由于其简单性，最优性，易处理性和鲁棒性而成为最广泛使用的跟踪和估计方法之一。然而，在非线性系统中应用ＫＦ是困难的。最常见的方法是使用ＥＫＦ，ＥＫＦ只是线性化所有非线性模型以便传统的ＫＦ可以被应用。虽然EKF是最广泛的滤波策略，但三十多年在跟踪和控制领域的经验已经让人们达成了一个共识：它很难被实施、很难被调整并且只有系统在更新时间范围内几乎是线性变化的系统是可靠地。

　　在这篇文章中一个新的非（原文中是线性）线性估计被发明和证实。利用一组离散采样点可用于对均值和协方差进行参数化的原理，估计器产生的性能与线性系统的KF相当，而在没有EKF要求的线性化步骤的情况下，可以优雅地推广到非线性系统。我们通过分析表明，新方法的预期性能优于EKF，并且实际上可以与二阶高斯滤波器直接媲美。该方法不严格的假设噪声服从高斯分布。我们认为，新滤波器的易实现性和更精确的估计特性使其在几乎所有应用中都优于EKF。


## 介绍

　　滤波和估计是工程师俩个最普遍的工具。无论什么时候系统状态必须被在带有噪声的传感器信息中估计出来，一些状态估计器将来自不同传感器的数据融合在一起，从而对真实的系统状态做出准确的估计。当系统的动态和观测模型是线性的时候，最小均方误差估计可以使用ＦＫ被计算。但是，在大多数感兴趣的应用中，系统动力学和观测方程是非线性的并且一直在寻找合适的扩展ＫＦ的方法。一个众所周知的解决非线性滤波的最佳方法是：保持对条件概率密度的完整描述。不幸的是，这种精确的描述需要潜在的无穷数量的参数，并且已经提出了许多次优的近似值。

　　可能最广泛的在非线性系统中使用的估计器是EKF。EKF应用卡尔曼滤波到非线性系统通过简单地线性化所有非线性模型以便传统的线性卡尔曼滤波方法可以被使用。然而，事实上使用EKF有俩个众所周知的缺点：

        １：如果违反局部线性的假设，则线性化会产生高度不稳定的滤波器

        ２：在大多数应用中推导雅克比矩阵是困难的

　　在本文中，我们推导了一种新的线性估计器，其产生的性能与线性系统的Kalman滤波器相当，但可以优雅地推广到非线性系统，而无需EKF进行线性化步骤。此过滤器的基本组件是无味转换(unscented transformation)，它使用一组适当选择的加权点来参数化概率分布的均值和协方差。我们已经证实新方法的预期性能优于EKF,并且事实上，它可以直接和二阶高斯滤波相比较。此外，变换的性质使得可以将过程和观察模型视为“黑匣子”。不必计算雅可比行列式，因此该算法具有优于EKF的实现特性。我们在一个示例应用程序中展示了性能上的差异，并且我们认为，由于新滤波器的易于实现和更精确的估计特性，因此我们建议在几乎所有应用程序中使用它而不是EKF。

　　文章结构如下。在第二部分中，我们描述了将卡尔曼滤波器应用于非线性系统的问题陈述。我们认为主要问题是预测系统状态的能力。第三部分介绍无味转换。分析其特性，并开发出一个完整的滤波算法，其中包括过程噪声的影响。第四部分给出一个例子。使用真实数据，对比无味滤波和ＥＫＦ跟踪折返机动物体。结论在第五章中被得出。一个附加段落， 对基本方法进行了扩展，并表明对于任何给定的先验分布，明智地选择附加点可以达到任何期望的精度水平。 


## 在非线性系统中的状态估计

### 2.1问题陈述

　　我们希望将KF应用到如下形式的非线性离散时间系统中：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/224.png)

x(k)是在时间ｋ时ｎ维系统状态，u(k)是输入向量，v(k)是由于扰动和建模误差引起的ｑ维状态过程噪声向量，z(k)是观测向量，w(k)是测量噪声。我们假设v(k)和w(k)为０均值以及：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/225.png)

  卡尔曼滤波器递归地传播“x（k）”分布的第一个(k)和第二个(k+1)时刻，并具有独特的“预测器-校正器”结构。x^(i|j)表示ｊ时刻的观测信息估计出来的x(i)，Zj= [z(1),...,z(j)]。估计的协方差是P(i|j)。给定一个估计值x^(k|k),滤波器首先使用过程模型预测未来状态。理想状态下，预测量由期望值给出

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/226.png)

  当f[.]和h[.]是非线性的，这些统计的精确值只能在x（k）的分布下计算，Zk状态是已知的。然而，此分布没有一般形式，并且可能需要无限数量的参数。在很多应用里，分布x(k)是近似的以便只需要传播有限且易处理的参数数量。通常假设x（k）的分布是高斯分布，这有两个原因。首先，仅用均值和协方差对分布进行完全参数化。其次，只知道俩个时刻信息，高斯分布是最少的信息。

  估计值x^(k+1|k+1)是通过被当前传感器测量更新预测出来的。在Kalman滤波器中，指定了一个线性更新规则，该规则以最小化估计的均方误差为目标来选择权重。更新规则如下：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/227.png)

　　这是重要的注意到这些等式只是一个可以预测第一个和第二个时刻x(k)和z(k)值的函数。因此，应用卡尔曼滤波到非线性系统的问题是有能力预测第一个和第二个时刻x(k)和z(k)。这个问题是一般问题的一个具体情况---能够计算一个经过非线性变换的随机变量的统计。

### 2.2不确定性的转化

　　预测系统未来状态或观测值的问题可以用以下形式表示。假设ｘ是一个随机变量，均值为ｘ-,协方差为Pxx。第二个随机变量y，通过非线性函数和ｘ产生联系。

ｙ＝ｆ[ｘ].......(5)

我们希望计算ｙ的均值ｙ-和协方差Pyy。

　　y的统计量是通过（i）确定转换分布的密度函数和（ii）评估该分布的统计量来计算的。在某些特殊情况下（例如，当f[.]是线性时）是精确的，存在闭式解。但是，此类解决方案通常不存在，必须使用近似方法。在本文中，我们主张该方法应产生一致的统计量。理想情况下，该方法应有效且无偏见。

　　如果不等式成立，则转换后的统计数据是一致的：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/228.png)

此条件对于转换方法的有效性极为重要。如果统计不是一致的，值Pyy被低估。如果卡尔曼滤波器使用不一致的统计信息集，则会对信息施加过多的权重，而低估了协方差，从而增加了滤波器发散的可能性。通过确保转化是一致的，也可以保证滤波器也是一致的。但是，一致性并不一定意味着有用，因为Pyy的计算值可能大大超出实际的均方误差。希望转换是有效的---应将等式6左侧的值最小化。最终希望估计是无偏的或者y-≈E[y]。

　　通过考虑方程5关于x-的泰勒级数展开，可以研究开发一致的、有效的和无偏的变换过程的问题。这个级数可以使用非正式符号表示为：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/229.png)

δx是零均值协方差为Pxx的高斯变量，▽nfδxn是多维泰勒级数中的适当阶项。根据期望，可以证明变换后的均值和协方差为

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/230.png)

换言之，x-级数中的n阶项是x的n阶矩(moments)乘以在x=x-处计算的f[.]的n阶导数的函数。如果矩(moments)和导数可以正确地评估到n阶，则平均值也可以正确地评估到n阶。尽管每个项的结构更复杂，但对协方差方程也有类似的评论。由于级数中的每个项都是按一个逐渐变小的项来缩放的，所以级数中最低阶的项可能具有最大的项影响。因此预测过程应侧重于对低阶项的估计。

　　线性化假设第二个和更高阶项δx在等式７中可以被忽略。在这个假设下

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/231.png)

与等式８和９比较这些表达式， 很明显，只有当均值中的二阶和高阶项以及协方差中的四阶和高阶项可以忽略不计时，这些近似才是准确的。但是，在许多实际情况下，线性化会产生明显的偏差或误差。一个非常普遍和重要的问题是极坐标和笛卡尔坐标系之间的信息转换。下一部分给出的简单示例对此进行了演示。

### 例子

　　假设一个移动机器人使用距离优化的声纳传感器检测环境中的信标。传感器返回极坐标信息（距离r和方位角μ），并将其转换为笛卡尔坐标估计值。传输如下：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/232.png)

目标的实际位置是(1,0)。这种转换的困难来自声纳的物理特性。相当好的距离精度(2cm标准差)但是却有一个非常差的方位(15°标准差)测量。较大的方位不确定性导致局部线性的假设被违反。为了解线性化可能引起的误差，将（x，y）统计量的值与通过蒙特卡洛模拟计算的真实统计量计算的值进行比较。由于随机抽样方法的收敛缓慢，为了确保获得对真实统计数据的准确估计，使用了大量样本(3.5x10的6次方)。结果展示在下图中：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/233.png)

该图显示了每种方法计算的平均值和1σ轮廓。1σ轮廓是点｛y:(y-y拔)P(-1,y）(y-y拔)=1｝的轨迹(解释：-1在P上面,y在P下面)并且是Pyy大小和方向的图形表示。可以看出，线性化变换是有偏的和不一致的。这在距离方向最为明显，线性化估计位置为1m，而实际为96.7cm。这是极其重要的。线性化误差实际上会引入超过范围测量标准偏差1.5倍的误差。由于这是由变换过程本身引起的偏差，因此每次进行坐标变换时都会犯相同符号的相同错误。即使没有偏差，转换也是不一致的。它的椭圆在r方向上不够长。实际上，不一致的性质加剧了偏差的问题：不仅估计值或r存在误差，而且其估计的均方误差也比真实值小得多。

　　 在实际应用中，可以通过引入额外的稳定噪声来解决这种不一致性，这种噪声增加了变换后协方差的大小。这是一种可能为什么ekf如此难以调整－－－必须引入足够的噪声以抵消线性化的缺陷。然而，引入稳定噪声是一个不理想的解决方案，因为估计仍然是有偏的，并且不能保证转换后的估计保持一致或有效。一个更精准的预测算法被需求。

##                              无味转换

### 3.1基本思想

  无味变换是一种新的新颖方法，用于计算经过非线性变换的随机变量的统计信息。它基于这样的直觉，即近似高斯分布要比近似任意非线性函数或变换要容易。该方法的图例如下：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/234.png)

选择一组点（或sigma点），以使它们的样本均值和样本协方差为x拔和Pxx。依次将非线性函数应用于每个点，以生成转换点云，并且y拔和Pyy是转换点的统计量。 虽然这种方法表面上与蒙特卡罗方法相似，但有一个极其重要和根本的区别。不会随机抽取样本，而是根据特定的确定性算法抽取样本。由于统计收敛问题不是问题，因此仅使用很少数量的点就可以捕获有关分布的高阶信息。

　　ｎ维随机变量ｘ均值为ｘ拔并且协方差为Pxx,可以近似为2n+1个加权点，如下：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/235.png)

转换过程如下：

1.通过函数实例化每个点以产生一组转换的sigma点.

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/236.png)

2.均值由转换点的加权平均值给出.

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/237.png)

3.协方差是变换点的加权外积.

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/238.png)

  该算法的属性已在其他地方进行了详细研究，我们在此处提供结果摘要：

  1.由于x的平均值和协方差精确到二阶，所以y的平均值和协方差的计算值也正确到二阶。这意味着均值的计算精度要比EKF更高，而协方差的计算精度也要与EKF相同。但是，还有其他性能优势。由于x的分布是近似值而不是f[.]，它的级数展开不是按特定顺序截断的。可以证明，无味算法能够部分地合并来自较高阶的信息，从而导致更高的准确性。 

  2.sigma点捕获相同的均值和协方差，而与所使用的矩阵平方根的选择无关.可以使用数值有效且稳定的方法，例如Cholesky分解。

  3.使用标准向量和矩阵运算来计算平均值和协方差。这意味着该算法适用于任何过程模型选择，并且实现起来非常迅速，因为不需要评估EKF中需要的雅可比行列式。

  4.κ提供了一个额外的自由度来“微调”逼近的高阶矩,并可以用来减少整体预测误差。当x(k)被假设为高斯型，一个有效的方法是选择n+k=3。如果x(k)的分布不同，那么κ的不同选择可能更合适。

  5.虽然κ可以是正或负数， 选择κ为负会导致Pyy的非正半定估计。对于近似高阶矩或概率密度分布的方法，此问题并不罕见。在这种情况下，可以使用预测算法的修改形式。平均值的计算和之前一样，但是协方差评估为χ0(k+1|k).可以看出，修改后的形式确保了正半定性和在（n+κ）→0的极限内，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/239.png)

  换句话说，可以使算法的执行与第二阶高斯滤波器完全相同，但无需计算Jacobian或Hessian。

  在下图中可以看到使用无味转换的性能优势，其中显示了由不同方法确定的均值和1σ轮廓。

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/240.png)

可以看出，无味的平均值与真实值相同---在图中的比例尺上，这两个点彼此重叠。此外，无味转换是一致的－－－事实上，它的轮廓比实际轮廓稍大。

　　鉴于其卓越的估算精度和易于实施的特性，对于滤波器应用，无味转换比线性化更适合。的确，因为它可以预测二阶精度的均值和协方差，任何使用无味变换的滤波器都将具有与截断的二阶高斯滤波器相同的性能，但不需要推导Jacobians或Hessians。下一部分将研究无味转换在过滤问题上的应用，以开发无味过滤器。

### 3.2UKF

  卡尔曼滤波器中发生的转换过程包括以下步骤：

  *预测系统状ｘ冒(k+1|k)态和相应的协方差P(k+1|k)。该预测必须考虑过程噪声的影响。

  *预测预期观测ｚ冒(k+1|k)和革新协方差Pvv(k+1|k)。该预测应该考虑观测噪声影响。

  *最后，预测互相关矩阵Pxz(k+1|k)。

  通过稍微重构状态向量以及过程和观察模型，可以轻松地容纳这些步骤.首先，用过程项和噪声项对状态向量进行扩增，得到一个n的a次方=n+q维向量,

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/241.png)

这个过程模型被重新写为x的ａ次方(k)函数，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/242.png)

并且无味传输使用2n的a次方＋１sigma点，这是来自：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/243.png)

  主对角线上的矩阵是协方差，非对角线上的子块是状态误差与过程噪声之间的相关性。虽然这种方法需要使用额外的sigma点，但这意味着引入过程噪声（就其对均值和协方差的影响而言）的影响与状态中的不确定度具有相同的精度。这个公式也意味着相关噪声源（这个在Schmidt-Kalman滤波器中可能会出现）可以非常容易地实现.描述无味传输的式子在下表中被给出：

 1.simga点集是通过将方程12应用于由方程15给出的扩增系统来创建的。

 2.通过过程模型实例化每个点得到转换集，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/244.png)

 3.计算预测的平均值，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/245.png)

 4.计算预测的协方差，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/246.png)

 5.通过观测模型实例化每一个预测点，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/247.png)

 6.预测观测值的计算公式为,

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/248.png)

 7.由于观测噪声是可加和独立的，因此革新协方差，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/249.png)

 8.最后，互相关矩阵计算如下，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/250.png)

  可以对该基本方法进行各种扩展和修改，以考虑给定应用程序的特定细节。例如，如果观测噪声是以非线性方式引入的，或者与过程和/或观测噪声相关，那么扩展向量以包括观测项。
  
  本部分开发了无味的转换，因此可以将其用于过滤和跟踪应用程序。下一部分将演示其在示例应用程序中相对于EKF的好处。


## 应用例子

  在本节中，我们考虑下图所示的问题。

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/251.png)

飞机以高海拔和极高的速度进入大气层。飞机的位置将由能够精确测量范围和方位的雷达跟踪。由于许多作用在飞机上的力表现出很强的非线性，许多作者已经将这种类型的问题确定为对于过滤器和跟踪器来说压力特别大。有三种类型的作用力. 最主要的是气动阻力，它是车速的函数，在不同高度上有很大的非线性变化。第二种力是重力，它使车辆向着地球中心加速。最后的力是随机抖振项。这些力的作用产生的轨迹如图所示.最初轨迹几乎是弹道的，但是随着大气密度的增加，阻力效应变得很重要，飞机迅速减速直至其运动几乎垂直。由于车辆的阻力特性可能只是非常粗略的了解，所以跟踪问题变得更加困难。(上图解释：虚线是样本车辆的轨迹，实线是地球表面的一部分，雷达的位置用o标记)

  总结，跟踪系统应能够跟踪遇到一组复杂的高度非线性力的物体。这些取决于车辆的当前位置和速度以及某些未知的精确特性。这个滤波器的状态空间包括机体位置(x1和x2)速度(x3和x4)和空气动力学特性的参数(x5),飞机的状态动态方程如下：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/252.png)

这里D(k)是与阻力相关的力项,G(k)是重力相关力项，v(k)是过程噪声项.定义R(k)=根号下(x1(k)平方+x2(k)平方)为到地球中心的距离并且V(k)=根号下(x3(k)平方+x4(k)平方)为作为绝对飞机速度，然后阻力和重力项如下:

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/253.png)

对于这个例子来说β0=-0.59783,H0=13.406,Gm0=3.9860x10的5次方并且R0=6374这些反映典型的环境和飞机特性.弹道系数的参数化β(k),反映车辆特性的不确定性.β0是“典型飞机”的弹道系数,它通过exp x5(k)缩放以确保其值始终为正.这对于滤波器的稳定性至关重要。

  飞机的运动由位于（xr,yr）处的雷达测量。它可以以10hz的频率测量距离r和方位角θ.如下:

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/254.png)

w1（k）和w2（k）是零均值不相关过程噪声，方差分别为1m和17mrad。传感器的高更新率和极高的精度意味着可以为过滤器提供大量极高质量的数据。方位的不确定度足以使EKFi能够以很小的偏差准确地预测传感器读数。

　　飞机真实的初始条件如下:

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/255.png)

换句话说，飞机的系数是标称系数的两倍。

  飞机受到随机加速度的缓冲,

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/256.png)

  滤波器假设的初始条件是，

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/257.png)

滤波器使用标称条件初始化，为了补偿不确定性，这个方差的初始估计为１.

  两个滤波器均在离散时间内实现，并且观测频率为10Hz.但是，由于飞机动力学方程的强烈非线性，方程16的欧拉近似仅对较小的时间步有效。集成步骤设置为50ms，这意味着每次更新都会进行两次预测.对于无味滤波器，每个sigma点通过动力学方程应用两次。对于EKF，有必要执行一个初始预测步骤，并在第二步之前重新线性化。

  每个滤波器的性能展示如下:

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/258.png)

上图解释：由EKF和无味滤波器计算出的均方误差和估计协方差。在所有的图片中实线代表由EKF计算出来的均方误差，虚线是其估计的协方差。虚线是无迹均方误差，点虚线是其估计协方差。此图将估计的均方差(P(k|k)的对角线元素)估计误差与实际均方差（使用100个蒙特卡洛模拟进行评估）估计误差相对应。只有x1,x3,x5被展示，因为x2和x1,x4和x3结果相似。在所有情况下，可以看出无味滤波器非常精确地估计了其均方误差，并且可以对滤波器估计充满信心。但是，EKF非常不一致：x1中的峰值均方误差为0.4km2,而其估计的协方差小一百倍.同样速度的均方误差是3.4x10-4次方km2平方乘s-2次方,它超过了真实的均方误差５倍多.最后，可以看出x5存在很大偏差，并且该偏置仅随时间缓慢减小。这种较差的性能是线性化误差的直接结果。


## 结论

  在本文中，我们认为将Kalman滤波器应用于非线性系统的主要困难是需要一致地预测系统的新状态和观测结果。我们引入了一种新的滤波算法，称为无味滤波器。 在无味变换的情况下，该算法比EKF有两个很大的优点。首先，它能够更准确地预测系统状态。 其次，它的实施难度要小得多。 在一个实际的例子中证明了该算法的好处。

  本文针对一组特定的假设考虑了无味变换的一种特定形式。在伴随论文中，我们扩展了无味变换的开发并提供了其推导和应用的通用框架。 可以扩展这些点以产生一个与力矩匹配的滤波器，该滤波器可以匹配直到四阶的矩。这种高阶扩展有效地消除了几乎所有常见的非线性坐标变换的偏差。
